<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ФАІТ</title>
    <link rel="stylesheet" href="css/style1.css">
    <link rel="stylesheet" href="css/showStudentCard.css">
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" />
    <link rel="icon" type="image/png" href="logo1.png">

</head>
<body>
    <nav class="sidebar">
        <div class="text"> <img src="logo1.png" width="36px"> КНУБА</div>
        <ul>
            <li>
                <a href="index.html">Головна</a>
            </li>
            <li>
                <a href="#" class="card-btn">Картка студента
                    <span class="fas fa-caret-down first"></span>
                </a>
                <ul class="card-show">
                    <li>
                        <a href="showStudentCard.html">Відобразити</a>
                    </li>
                    <li>
                        <a href="addStudentCart.html">Додати</a>
                    </li>
                </ul>
            </li>
            <li>
                <a href="#" class="plan-btn">Навчальний план
                    <span class="fas fa-caret-down second"></span>
                </a>
                <ul class="plan-show">
                    <li>
                        <a href="curriculum.html">Відобразити</a>
                    </li>
                    <li>
                        <a href="addCurriculum.html">Додати</a>
                    </li>
                </ul>
            </li>
            <li>
                <a href="transferStudent.html">Перевести</a>
            </li>
            <li>
                <a href="progress.html">Успішність</a>
            </li>
            <li>
                <a href="createReport.html">Створити звіт</a>
            </li>
            <li>
                <a href="createStudentGroup.html">Створити групу(и)</a>
            </li>
        </ul>
    </nav>
    <div class="content">
        <h1>Факультет автоматизацїї та інформаційних технологій</h1>
        <section id="section1">
            <br>

            Спеціальність:
            <select>
                <option>
                    Оберіть спеціальність
                </option>
            </select>
            Спеціалізація:
            <select>
                <option>
                    Оберіть спеціалізацію
                </option>
            </select>
            Рік: <input type="text" id="select1" placeholder="Введіть рік"></br>

            Курс: <select>
                <option>
                    Оберіть курс
                </option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
            </select>
            Група: <select id="group">
                <option>
                    Оберіть група
                </option>
            </select>

            Студент: <select id="student">
                <option>
                    Оберіть студента
                </option>
            </select></br>

            <button id="show"> Показати </button>
        </section>

        <h2>Навчальна картка студента</h2>
        <section id="section2">

            Прізвище: <input id="surname" type="text" width="80px" class="change"> <button id="changeForm"> Змінити
            </button></br>
            Ім'я: <input id="name" type="text" class="change"> </br>
            По-батькові: <input id="middle_name" type="text" class="change"> </br>
            Середній бал: <input id="gpa" type="text" class="change"> <button> Розрахувати </button> </br>
            Дата народження: <input id="birthday" type="date" class="change"> </br>
            Місце народження: <input id="birthplace" type="text" class="change"> </br>
            Громадянство <input id="citizenship" type="text" class="change"></br>
            Сімейний стан:
            <select id="marital_status" class="change">
                <option value="1">
                    Обрати статус
                </option>
                <option value="2">
                    Одружений/Заміжня
                </option>
                <option value="3">
                    Не одружений/Не заміжня
                </option>
            </select></br>
            Місце проживання/місце реєстрації: <input id="registration_place" type="text" class="change"> </br>
            Наявність пільг при вступі:
            <input id="exemption" type="text" class="change"></br>
            Зарахований(а) наказом від: <input id="date_reckoned" type="date" width="80px" class="change">
            №<input id="number_reckoned" type="text" class="change"  onkeyup="this.value = this.value.replace(/[^\d]/g,'');"></br>
            Трудова книжка: <input id="employment_history_number" type="text" class="change" onkeyup="this.value = this.value.replace(/[^\d]/g,'');">
            <input id="employment_given_date" type="date">
            <input id="employment_history_by_whom_issued" type="text" class="change"></br>
            Реєстраційний номер облікової картки
            платника податків
            або серія та номер паспорту:<input id="registration_or_passport_number" type="text" class="change" onkeyup="this.value = this.value.replace(/[^\d]/g,'');"></br>
            Статус студента:
            <select id="student_status" class="change">
                <option value="1">
                    Оберіть статус
                </option>
                <option value="2">
                    Переведен з групой
                </option>
                <option value="3">
                    В академічній відпустці
                </option>
                <option value="4">
                    Не закрив сесію
                </option>
                <option value="5">
                    Виключен з навчання
                </option>
                <option value="6">
                    Закінчив степінь
                </option>
            </select></br>

            Переведення з курсу на курс,
            перерва в академ. навчанні: </br>
            <table border="1px" width="50%">
                <tr>
                    <td>Курс</td>
                    <td>Номер наказу</td>
                    <td>Дата наказу</td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </table></br>

            <button id="saveChanges"> Зберегти </button>
        </section>
    </div>

    <script>
        $('.card-btn').click(function () {
            $('nav ul .card-show').toggleClass("show");
            $('nav ul .first').toggleClass("rotate");
        });
        $('.plan-btn').click(function () {
            $('nav ul .plan-show').toggleClass("show1");
            $('nav ul .second').toggleClass("rotate");
        });

        // змінити
        //$(function () {
        //    $("input.change").attr("disabled", "disabled");
        //    $("button.changeForm").click(
        //        function () {
        //            if ($(this).click) $("input.change").attr("disabled", "disabled")
        //            else $("input.change").removeAttr("disabled")
        //        }
        //    )
        //});


        document.getElementById('group').onclick = function (e) {
            e.preventDefault();
            var selected = this.selectedIndex;
            fetch('api/Group/GetGroups', {
                method: 'GET'
            })
                .then((resp) => resp.json())
                .then(function (data) {
                    let groups = data;

                    var select = document.getElementById('group');
                    removeOptions(select);
                    select.value = this.innerHTML;
                    this.innerHTML = '';
                    for (var i in groups) {
                        var option = document.createElement("option");
                        option.setAttribute("value", groups[i].groupId);

                        option.text = groups[i].groupName;

                        select.appendChild(option);
                    }
                }).then(function () {
                    document.getElementById("group").selectedIndex = selected;
                })
        };

        document.getElementById('saveChanges').onclick = function (e) {
            e.preventDefault();

            let data = {
                LastName: document.getElementById('surname').value,
                FirstName: document.getElementById('name').value,
                Patronymic: document.getElementById('middle_name').value,
                Birthday: document.getElementById('birthday').value,
                BirthPlace: document.getElementById('birthplace').value,
                Immenseness: document.getElementById('citizenship').value,
                MaritalStatusId: document.getElementById('marital_status').value,
                Registration: document.getElementById('registration_place').value,
                Exemption: document.getElementById('exemption').value,
                OrderDate: document.getElementById('date_reckoned').value,
                //ExpirienceCompetitionId: document.getElementById('competition').value,
                //TransferFrom: document.getElementById('transfer_order').value,
                //TransferDirection: document.getElementById('by_direction').value,
                //CompetitionConditions: document.getElementById('special_conditions_of_competition').value,
                //OutOfCompetitionInfo: document.getElementById('out_of_competition').value,
                //AmmendsId: document.getElementById('full_refund').value,
                OrderNumber: document.getElementById('number_reckoned').value,
                EmploymentNumber: document.getElementById('employment_history_number').value,
                EmploymentGivenDate: document.getElementById('employment_given_date').value,
                EmploymentAuthority: document.getElementById('employment_history_by_whom_issued').value,
                RegistrOrPassportNumber: document.getElementById('registration_or_passport_number').value,
                StudentStateId: document.getElementById('student_status').value
            }

            var studentId = document.getElementById('student').value;
            var url = 'api/StudentCard/UpdateStudentCardInfo?studentId=' + studentId;
            fetch(url, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data),
            })
                //.then((resp) => resp.json())
                //.then(function (resp) {
                //    alert(resp.msg);
                //})
        };

        document.getElementById('show').onclick = function (e) {
            e.preventDefault();

            var studentId = document.getElementById('student').value;

            var url = 'api/StudentCard/ShowStudentInfo?studentId=' + studentId;
            fetch(url, {
                method: 'GET'
            })
                .then((resp) => resp.json())
                .then(function (data) {
                    let studentInfo = data;

                    document.getElementById('surname').value = studentInfo.lastName;
                    document.getElementById('name').value = studentInfo.firstName;
                    document.getElementById('middle_name').value = studentInfo.patronymic;
                    document.getElementById('birthday').value = studentInfo.birthday;
                    document.getElementById('birthplace').value = studentInfo.birthPlace;
                    document.getElementById('citizenship').value = studentInfo.immenseness;
                    document.getElementById('marital_status').value = studentInfo.maritalStatusId;
                    document.getElementById('registration_place').value = studentInfo.registration;
                    document.getElementById('exemption').value = studentInfo.exemption;
                    document.getElementById('date_reckoned').value = studentInfo.orderDate;
                    //document.getElementById('competition').value = studentInfo.expirienceCompetitionId;
                    //document.getElementById('transfer_order').value = studentInfo.transferFrom;
                    //document.getElementById('by_direction').value = studentInfo.transferDirection;
                    //document.getElementById('special_conditions_of_competition').value = studentInfo.competitionConditions;
                    //document.getElementById('out_of_competition').value = studentInfo.outOfCompetitionInfo;
                    //document.getElementById('full_refund').value = studentInfo.ammendsId;
                    document.getElementById('number_reckoned').value = studentInfo.orderNumber;
                    document.getElementById('employment_history_number').value = studentInfo.employmentNumber;
                    document.getElementById('employment_given_date').value = studentInfo.employmentGivenDate;
                    document.getElementById('employment_history_by_whom_issued').value = studentInfo.employmentAuthority;
                    document.getElementById('registration_or_passport_number').value = studentInfo.registrOrPassportNumber;
                    document.getElementById('student_status').value = studentInfo.studentStateId;

                })
        };

        document.getElementById('student').onclick = function (e) {
            e.preventDefault();

            var selected = this.selectedIndex;
            var groupId = document.getElementById('group').value;

            var url = 'api/StudentCard/GetStudents?groupId=' + groupId;
            fetch(url, {
                method: 'GET'
            })
                .then((resp) => resp.json())
                .then(function (data) {
                    let students = data;

                    var select = document.getElementById('student');
                    removeOptions(select);
                    select.value = this.innerHTML;
                    this.innerHTML = '';
                    for (var i in students) {
                        var option = document.createElement("option");

                        option.setAttribute("value", students[i].studentId);
                        option.text = students[i].studentName;

                        select.appendChild(option);
                    }
                }).then(function () {
                    document.getElementById("student").selectedIndex = selected;
                })
        };

        function removeOptions(selectElement) {
            var i, L = selectElement.options.length - 1;
            for (i = L; i > 0; i--) {
                selectElement.remove(i);
            }
        }
    </script>
</body>

</html>